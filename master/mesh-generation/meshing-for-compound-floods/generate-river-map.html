
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-8.3.4">
    
    
      
        <title>Generate river map - SCHISM</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4a0965b7.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#scripts" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
        </aside>
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="SCHISM" class="md-header__button md-logo" aria-label="SCHISM" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SCHISM
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Generate river map
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/schism-dev/schism" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="SCHISM" class="md-nav__button md-logo" aria-label="SCHISM" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    SCHISM
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/schism-dev/schism" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../changelog.html" class="md-nav__link">
        Changelog
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Getting started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting started" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Getting started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../schism/overview.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/getting-sourcecode.html" class="md-nav__link">
        Getting the source code
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/compilation.html" class="md-nav__link">
        Compilation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/test_suite.html" class="md-nav__link">
        Test suite
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/typical-workflow.html" class="md-nav__link">
        Typical workflow (a cheat sheet)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/grid-generation.html" class="md-nav__link">
        Mesh generation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/pre-processing.html" class="md-nav__link">
        Preprocessing
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_8" type="checkbox" id="__nav_3_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_8">
          Preprocessing with pylib
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Preprocessing with pylib" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_8">
          <span class="md-nav__icon md-icon"></span>
          Preprocessing with pylib
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/pre-processing-with-pylib/overview.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/pre-processing-with-pylib/installation.html" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/pre-processing-with-pylib/schismcheck.html" class="md-nav__link">
        schismCheck (input visualization)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_9" type="checkbox" id="__nav_3_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_9">
          Preprocessing with PySCHISM
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Preprocessing with PySCHISM" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_9">
          <span class="md-nav__icon md-icon"></span>
          Preprocessing with PySCHISM
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/pre-processing-with-pyschism/overview.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/pre-processing-with-pyschism/installation.html" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/pre-processing-with-pyschism/bctides.html" class="md-nav__link">
        Tides
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/pre-processing-with-pyschism/boundary.html" class="md-nav__link">
        B.C. from HYCOM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/pre-processing-with-pyschism/atmos.html" class="md-nav__link">
        Atmospheric forcing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/pre-processing-with-pyschism/nwm.html" class="md-nav__link">
        Souce and Sink
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/running-model.html" class="md-nav__link">
        Running the model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/visualization.html" class="md-nav__link">
        Visualization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/post-processing.html" class="md-nav__link">
        Postprocessing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Model formulation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Model formulation" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Model formulation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../schism/physical-formulation.html" class="md-nav__link">
        Physical formulation
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Numerical formulation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Numerical formulation" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Numerical formulation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../schism/geometry-discretization.html" class="md-nav__link">
        Geometry and discretization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../schism/barotropic-solver.html" class="md-nav__link">
        Barotropic solver
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../schism/eulerian-lagrangian-method.html" class="md-nav__link">
        Eulerian-Lagrangian Method
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../schism/momentum-equation.html" class="md-nav__link">
        Momentum equation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../schism/vertical-velocity.html" class="md-nav__link">
        Vertical velocity
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../schism/turbulence-closure.html" class="md-nav__link">
        Turbulence closure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../schism/transport-equation.html" class="md-nav__link">
        Transport equation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../schism/updating-levels.html" class="md-nav__link">
        Updating the levels/Inundation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../schism/spherical-coordinates.html" class="md-nav__link">
        Spherical coordinates
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Input/Output
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Input/Output" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Input/Output
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../input-output/overview.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../input-output/hgrid.html" class="md-nav__link">
        Horizontal grid (hgrid.gr3)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../input-output/vgrid.html" class="md-nav__link">
        Vertical grid (vgrid.in)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../input-output/param.html" class="md-nav__link">
        Model parameters (param.nml)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../input-output/bctides.html" class="md-nav__link">
        Boundary conditions (bctides.in)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../input-output/friction.html" class="md-nav__link">
        Bottom friction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../input-output/sflux.html" class="md-nav__link">
        Atmospheric flux (/sflux)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../input-output/optional-inputs.html" class="md-nav__link">
        Optional inputs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../input-output/outputs.html" class="md-nav__link">
        Outputs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Mesh generation - advanced topics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Mesh generation - advanced topics" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Mesh generation - advanced topics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../overview.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cross_regime.html" class="md-nav__link">
        Meshing for cross-scale regimes
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3" type="checkbox" id="__nav_6_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6_3">
          Meshing for compound floods
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Meshing for compound floods" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          Meshing for compound floods
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="overview.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="extract-thalweg.html" class="md-nav__link">
        Extract thalwegs
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Generate river map
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="generate-river-map.html" class="md-nav__link md-nav__link--active">
        Generate river map
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#scripts" class="md-nav__link">
    Scripts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sample-applications" class="md-nav__link">
    Sample applications
  </a>
  
    <nav class="md-nav" aria-label="Sample applications">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#meshing-watershed-rivers-in-a-small-domain-serial-mode" class="md-nav__link">
    Meshing watershed rivers in a small domain (Serial mode)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#meshing-rivers-in-a-large-domain-parallel-mode" class="md-nav__link">
    Meshing rivers in a large domain (Parallel mode)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-parameterization" class="md-nav__link">
    Advanced Parameterization
  </a>
  
    <nav class="md-nav" aria-label="Advanced Parameterization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mandatory-input-parameters" class="md-nav__link">
    Mandatory input parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-input-parameters" class="md-nav__link">
    Optional input parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parameter-presets" class="md-nav__link">
    Parameter presets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-parameterization" class="md-nav__link">
    More parameterization
  </a>
  
    <nav class="md-nav" aria-label="More parameterization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hudson-river-and-tributaries" class="md-nav__link">
    Hudson River and tributaries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#levees" class="md-nav__link">
    Levees
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#barrier-islands" class="md-nav__link">
    Barrier islands
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experimental-features" class="md-nav__link">
    Experimental Features
  </a>
  
    <nav class="md-nav" aria-label="Experimental Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#global-arc-cleaning" class="md-nav__link">
    Global arc cleaning
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#outputs-for-ocsmesh" class="md-nav__link">
    Outputs for OCSMesh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#outputting-river-mesh-elements" class="md-nav__link">
    Outputting river mesh elements
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="meshing-in-SMS.html" class="md-nav__link">
        Meshing in SMS
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Modules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Modules" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Modules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/overview.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/generic-tracer.html" class="md-nav__link">
        Generic tracer module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/age.html" class="md-nav__link">
        AGE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/sed2d.html" class="md-nav__link">
        2D Sediment model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/sed3d.html" class="md-nav__link">
        3D Sediment model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/icm.html" class="md-nav__link">
        ICM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/cosine.html" class="md-nav__link">
        CoSiNe
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/dvd.html" class="md-nav__link">
        DVD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/marsh-migration.html" class="md-nav__link">
        Marsh migration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/analysis-mode.html" class="md-nav__link">
        Analysis mode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/hydraulics.html" class="md-nav__link">
        Hydraulics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/particle-tracking.html" class="md-nav__link">
        Particle tracking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/wwm.html" class="md-nav__link">
        WWM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/fabm.html" class="md-nav__link">
        FABM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/pahm.html" class="md-nav__link">
        PaHM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../modules/single-class-ice.html" class="md-nav__link">
        Single-class ice module
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../code-contribution.html" class="md-nav__link">
        Code structure
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../case-study.html" class="md-nav__link">
        Case studies
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      
      
      
        <label class="md-nav__link" for="__nav_10">
          SCHISM external coupling
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="SCHISM external coupling" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          SCHISM external coupling
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../coupling/esmf.html" class="md-nav__link">
        Earth System Modeling Framework
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../coupling/nuopc.html" class="md-nav__link">
        National Unified Operational Prediction Capability
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../coupling/coastalapp.html" class="md-nav__link">
        NOAA's CoastalApp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../coupling/mossco.html" class="md-nav__link">
        Modular System for Shelves and Coasts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../coupling/cesm.html" class="md-nav__link">
        NCAR's Community Earth System Model
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../faq.html" class="md-nav__link">
        Frequently Asked Questions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../known_issues.html" class="md-nav__link">
        Known issues
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../contribute-to-this-online-manual.html" class="md-nav__link">
        Contribute to this online manual
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/schism-dev/schism/edit/master/docs/mesh-generation/meshing-for-compound-floods/generate-river-map.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



  <h1>Generate river map</h1>

<h2 id="scripts">Scripts<a class="headerlink" href="#scripts" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/schism-dev/RiverMeshTools/tree/main/RiverMapper">RiverMapper</a> is available from the <a href="https://github.com/schism-dev/RiverMeshTools">RiverMeshTools repository</a> under schism-dev.</p>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<p>RiverMapper requires two inputs:</p>
<ol>
<li>
<p>*.tif, which are DEM tiles in lon/lat from one or more sources.</p>
</li>
<li>
<p>a shapefile with a 'LineString' type, which contains a 1D river network.</p>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The 1D river network can be any reasonable approximation of the thalwegs. It can be:
<ul>
    <li>extracted from DEM using the method presented in the <a href="extract-thalweg.html">previous section</a></li>
    <li>or duplicated from the river network of a hydrological model such as the National Water Model</li>
    <li>or manually drawn for <a href="">quick local touch-ups</a></li>
</ul></p>
</div>
<p>The outputs include:</p>
<ul>
<li>
<p>"total_river_arcs.map", which contains river arcs to be used for the final meshing in SMS.</p>
</li>
<li>
<p>other *.map files for diagnostic purposes.</p>
</li>
</ul>
<p>A sample output looks like this:</p>
<p><img alt="Sample river map" src="../../assets/sample-river-map.png" /> </p>
<h2 id="sample-applications">Sample applications<a class="headerlink" href="#sample-applications" title="Permanent link">&para;</a></h2>
<p>To test the RiverMapper tool, you can start by extracting the "RiverMapper_Samples/" directory from <a href="http://ccrm.vims.edu/yinglong/feiye/Public/RiverMapper_Samples.tar">RiverMapper_Samples.tar</a>.
Find the following two subdirectories: "Serial" and "Parallel", which provide sample applications for meshing watershed rivers in a smaller domain and a larger domain respectively.
Each subdirectory contains a sample Python script and the necessary input files.</p>
<p>Note that these two samples use the default settings suitable for small watershed rivers that are 
narrower than a few hundred meters.
Similar settings are used in the latest version of NOAA's operational forecast <a href="https://nauticalcharts.noaa.gov/updates/introducing-the-inland-coastal-flooding-operational-guidance-system-icogs/">STOFS3D Atlantic</a>.
If you are interested in meshing rivers with a wider range of widths, check samples with more parameter settings <a href="#more-parameterization">below</a>.</p>
<h3 id="meshing-watershed-rivers-in-a-small-domain-serial-mode">Meshing watershed rivers in a small domain (Serial mode)<a class="headerlink" href="#meshing-watershed-rivers-in-a-small-domain-serial-mode" title="Permanent link">&para;</a></h3>
<p>For a small domain (covering one or two states), a direct function call to the serial "make_river_map" suffices.
See the sample script:
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>RiverMapper_Samples/Serial/sample_serial.py
</code></pre></div>
, which reads:
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span> <span class="nn">RiverMapper.make_river_map</span> <span class="kn">import</span> <span class="n">make_river_map</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="sd">    A sample serial application of RiverMapper</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    <span class="n">make_river_map</span><span class="p">(</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>        <span class="n">tif_fnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;./Inputs/DEMs/GA_dem_merged_ll.tif&#39;</span><span class="p">],</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>        <span class="n">thalweg_shp_fname</span> <span class="o">=</span> <span class="s1">&#39;./Inputs/Shapefiles/GA_local.shp&#39;</span><span class="p">,</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>        <span class="n">output_dir</span> <span class="o">=</span> <span class="s1">&#39;./Outputs/&#39;</span><span class="p">,</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>    <span class="p">)</span>
</code></pre></div></p>
<p>Under the  directory "RiverMapper_Samples/Serial/", execute the serial script like this:
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>./sample_serial.py
</code></pre></div></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>Although only one DEM tile is used in this example, but multiple DEM tiles are allowed.</li>
<li>If the tiles are from different DEM sources, they should be arranged from high to low priority in the list.
    Tiles from the high priority DEM source should have high fidelity and high resolution.</li>
<li>The script allows DEM tiles of different sizes and shapes.</li>
</ul>
</div>
<h3 id="meshing-rivers-in-a-large-domain-parallel-mode">Meshing rivers in a large domain (Parallel mode)<a class="headerlink" href="#meshing-rivers-in-a-large-domain-parallel-mode" title="Permanent link">&para;</a></h3>
<p>For a large domain such as <a href="https://nauticalcharts.noaa.gov/updates/introducing-the-inland-coastal-flooding-operational-guidance-system-icogs/">STOFS3D Atlantic</a>,
a parallel driver is provided to automatically group thalwegs based on their parent tiles, then distribute the groups to parallel processors.</p>
<p>The sample parallel script is:
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>RiverMapper_Samples/Parallel/sample_parallel.py
</code></pre></div>
, which reads:
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kn">import</span> <span class="nn">os</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="kn">from</span> <span class="nn">RiverMapper.river_map_mpi_driver</span> <span class="kn">import</span> <span class="n">river_map_mpi_driver</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>    <span class="n">comm</span><span class="o">=</span><span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    <span class="c1"># ------------------------- sample input ---------------------------</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    <span class="n">dems_json_file</span> <span class="o">=</span> <span class="s1">&#39;./Inputs/DEMs/dems.json&#39;</span>  <span class="c1"># specifying files for all DEM tiles</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    <span class="n">thalweg_shp_fname</span><span class="o">=</span><span class="s1">&#39;./Inputs/Shapefiles/LA_local.shp&#39;</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    <span class="n">output_dir</span> <span class="o">=</span> <span class="s1">&#39;./Outputs/&#39;</span> <span class="o">+</span>  <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">thalweg_shp_fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">comm</span><span class="o">.</span><span class="n">Get_size</span><span class="p">()</span><span class="si">}</span><span class="s1">-core/&#39;</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>    <span class="c1"># ------------------------- end input section ---------------------------</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>    <span class="n">river_map_mpi_driver</span><span class="p">(</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>        <span class="n">dems_json_file</span><span class="o">=</span><span class="n">dems_json_file</span><span class="p">,</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>        <span class="n">thalweg_shp_fname</span><span class="o">=</span><span class="n">thalweg_shp_fname</span><span class="p">,</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>        <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>        <span class="n">comm</span><span class="o">=</span><span class="n">comm</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>    <span class="p">)</span>
</code></pre></div></p>
<p>In stead of specifying a file list for the DEM tiles as in the serial example,
the first argument takes a *.json file that specifies multiple sets of DEMs, for example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="p">{</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span><span class="nt">&quot;CuDEM&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CuDEM&quot;</span><span class="p">,</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">        </span><span class="nt">&quot;glob_pattern&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./Inputs/DEMs/CuDEM/*.tif&quot;</span><span class="p">,</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">        </span><span class="nt">&quot;file_list&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">        </span><span class="nt">&quot;boxes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">    </span><span class="nt">&quot;CRM&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CRM&quot;</span><span class="p">,</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">        </span><span class="nt">&quot;glob_pattern&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./Inputs/DEMs/CRM/*.tif&quot;</span><span class="p">,</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">        </span><span class="nt">&quot;file_list&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">        </span><span class="nt">&quot;boxes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="p">}</span>
</code></pre></div></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul>
<li>
<p>For each DEM source, specify a glob pattern and/or a list of file names;
if both are specified, the script will pool all files together and take the unique files.</p>
</li>
<li>
<p>No need to manually specify the bounding "boxes", just leave them empty.</p>
</li>
<li>
<p>Different DEM products should be arranged from high priority to low priority.
The order of the dictionary key ("CuDEM" and "CRM") is preserved as long as you are using Python 3.7 or a later version.
We may replace the regular dictionary to OrderedDict if there is a need.</p>
</li>
</ul>
</div>
<p>Under the directory "RiverMapper_Samples/Parallel/", execute the parallel script like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>mpirun -n 20 ./sample_parallel.py
</code></pre></div>
<p>The exact mpi command may vary based on your system.</p>
<h2 id="advanced-parameterization">Advanced Parameterization<a class="headerlink" href="#advanced-parameterization" title="Permanent link">&para;</a></h2>
<h3 id="mandatory-input-parameters">Mandatory input parameters<a class="headerlink" href="#mandatory-input-parameters" title="Permanent link">&para;</a></h3>
<p>In the "Serial" and "Parallel" examples above, you may have noticed there are 3 mandatory Inputs:</p>
<table>
<thead>
<tr>
<th>parameter</th>
<th>explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td>tif_fnames (or a *.json file if there are many tiles)</td>
<td>a list of TIF file names. These TIFs should cover the area of interest and be arranged by priority (higher priority ones in front)</td>
</tr>
<tr>
<td>thalweg_shp_fname</td>
<td>name of a polyline shapefile containing the thalwegs</td>
</tr>
<tr>
<td>output_dir</td>
<td>must specify one.</td>
</tr>
</tbody>
</table>
<h3 id="optional-input-parameters">Optional input parameters<a class="headerlink" href="#optional-input-parameters" title="Permanent link">&para;</a></h3>
<p>In addition to the mandatory inpouts, RiverMapper provides a few parameters to fine tune the output polylines or generate special features like levees or pseudo-channels.</p>
<table>
<thead>
<tr>
<th>parameter</th>
<th>type</th>
<th>explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td>selected_thalweg</td>
<td>integer numpy array</td>
<td>Indices of a subset of thalwegs for which the river arcs will be sought; mainly used by the parallel driver</td>
</tr>
<tr>
<td>output_prefix</td>
<td>string</td>
<td>a prefix of the output files, mainly used by the caller of this script; can be empty</td>
</tr>
<tr>
<td>mpi_print_prefix</td>
<td>string</td>
<td>a prefix string to identify the calling mpi processe in the output messages; can be empty</td>
</tr>
<tr>
<td>river_threshold</td>
<td>float</td>
<td>minimum and maximum river widths (in meters) to be resolved</td>
</tr>
<tr>
<td>min_arcs</td>
<td>integer</td>
<td>minimum number of arcs to resolve a channel (including bank arcs, inner arcs and outer arcs)</td>
</tr>
<tr>
<td>width2narcs_option</td>
<td>string or callable</td>
<td>pre-defined options ('regular', 'sensitive', 'insensitve') or  'custom' if a user-defined function is specified</td>
</tr>
<tr>
<td>custom_width2narcs</td>
<td>a user-defined function</td>
<td>a function that takes one parameter 'width' and returns 'narcs', i.e., the number of arcs in the cross-channel direction</td>
</tr>
<tr>
<td>elev_scale</td>
<td>float</td>
<td>scaling factor for elevations; a number of -1 (invert elevations) is useful for finding ridges (e.g., of a barrier island)</td>
</tr>
<tr>
<td>outer_arc_positions</td>
<td>a tuple of floats</td>
<td>relative position of outer arcs, e.g., (0.1, 0.2) will add 2 outer arcs on each side of the river (4 in total), 0.1 * riverwidth and 0.2 * riverwidth from the banks.</td>
</tr>
<tr>
<td>R_coef</td>
<td>float</td>
<td>coef controlling the along-channel resolutions at river bends (with a radius of R), a larger number leads to coarser resolutions (R*R_coef)</td>
</tr>
<tr>
<td>length_width_ratio</td>
<td>float</td>
<td>the ratio between along-channel resolution and cross-channel resolution</td>
</tr>
<tr>
<td>along_channel_reso_thres</td>
<td>a tuple of 2 floats</td>
<td>the minimum and maximum along-channel resolution (in meters)</td>
</tr>
<tr>
<td>snap_point_reso_ratio</td>
<td>float</td>
<td>scaling the threshold of the point snapping; a negtive number means absolute distance value</td>
</tr>
<tr>
<td>snap_arc_reso_ratio</td>
<td>float</td>
<td>scaling the threshold of the arc snapping; a negtive number means absolute distance value</td>
</tr>
<tr>
<td>n_clean_iter</td>
<td>int</td>
<td>number of iterations for cleaning; more iterations produce cleaner intersections and better channel connectivity</td>
</tr>
<tr>
<td>i_close_poly</td>
<td>bool</td>
<td>whether to add cross-channel arcs to enclose river arcs into a polygon</td>
</tr>
<tr>
<td>i_smooth_banks</td>
<td>bool</td>
<td>whether to smooth the river banks at abrupt changes of the curvature</td>
</tr>
<tr>
<td>i_DEM_cache</td>
<td>bool</td>
<td>Whether or not to read DEM info from cache.  Reading from original *.tif files can be slow, so the default option is True</td>
</tr>
<tr>
<td>i_OCSMesh</td>
<td>bool</td>
<td>Whether or not to generate polygon-based outputs to be used as inputs to OCSMesh</td>
</tr>
<tr>
<td>i_DiagnosticsOutput</td>
<td>bool</td>
<td>whether to output diagnostic information</td>
</tr>
<tr>
<td>i_pseudo_channel</td>
<td>int</td>
<td>0:  default, no pseudo channel, nrow_pseudo_channel and pseudo_channel_width are ignored; 1: fixed-width channel with nrow elements in the cross-channel direction, it can also be used to generate a fixed-width levee for a given levee centerline; 2: implement a pseudo channel when the river is poorly defined in DEM</td>
</tr>
<tr>
<td>pseudo_channel_width</td>
<td>float</td>
<td>width of the pseudo channel (in meters)</td>
</tr>
<tr>
<td>nrow_pseudo_channel</td>
<td>int</td>
<td>number of rows of elements in the cross-channel direction in the pseudo channel</td>
</tr>
</tbody>
</table>
<p>You can change the values of these parameters so that the output river map better fits your application (otherwise default values are used).
For example, if you want to add two pairs of outer arcs that flank the main river channel, you can do:
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>    <span class="n">make_river_map</span><span class="p">(</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>        <span class="n">tif_fnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;./Inputs/DEMs/GA_dem_merged_ll.tif&#39;</span><span class="p">],</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>        <span class="n">thalweg_shp_fname</span> <span class="o">=</span> <span class="s1">&#39;./Inputs/Shapefiles/GA_local.shp&#39;</span><span class="p">,</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>        <span class="n">output_dir</span> <span class="o">=</span> <span class="s1">&#39;./Outputs/&#39;</span><span class="p">,</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>        <span class="n">outer_arc_positions</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    <span class="p">)</span>
</code></pre></div>
, where the last argument specifies the relative distances of the outer arcs to the main channel.
In this case two outer arcs will be placed to the left of the channel at distances of "<span class="arithmatex">\(0.1 \times\)</span> channel width" and "<span class="arithmatex">\(0.2 \times\)</span> channel width" from the left bank;
the same goes for the right bank, so 4 outer arcs in total.</p>
<h2 id="parameter-presets">Parameter presets<a class="headerlink" href="#parameter-presets" title="Permanent link">&para;</a></h2>
<p>Tuning the parameters may not be easy at first because there are many of them.
To simplify the parameter configuration, RiverMapper offers a class called "ConfigRiverMap",
which provides commonly used parameter presets.
These presets are "class methods" in <a href="https://github.com/schism-dev/RiverMeshTools/blob/main/RiverMapper/RiverMapper/config_river_map.py">config_river_map.py</a>,
and each preset (class method, or factory method) comes with a short description in the code.</p>
<p>For example, the preset "LooselyFollowRivers" means that "Small-scale river curvatures may not be exactly followed, but channel connectivity is still preserved",
and this is the sample code:
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>    <span class="kn">from</span> <span class="nn">RiverMapper.config_river_map</span> <span class="kn">import</span> <span class="n">ConfigRiverMap</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>    <span class="n">river_map_config</span> <span class="o">=</span> <span class="n">ConfigRiverMap</span><span class="o">.</span><span class="n">LooselyFollowRivers</span><span class="p">()</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    <span class="n">make_river_map</span><span class="p">(</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>        <span class="n">tif_fnames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;./Inputs/DEMs/GA_dem_merged_ll.tif&#39;</span><span class="p">],</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>        <span class="n">thalweg_shp_fname</span> <span class="o">=</span> <span class="s1">&#39;./Inputs/Shapefiles/GA_local.shp&#39;</span><span class="p">,</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>        <span class="n">output_dir</span> <span class="o">=</span> <span class="s1">&#39;./Outputs/&#39;</span><span class="p">,</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>        <span class="o">**</span><span class="n">river_map_config</span><span class="o">.</span><span class="n">optional</span><span class="p">,</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>    <span class="p">)</span>
</code></pre></div>
and the operator "**" unpacks the optional parameters from the configuration.</p>
<p>Another utility of the "ConfigRiverMap" class is to facilitate the parameter transfer from the parallel driver to the core routine.
The stardard way of setting the parameters in the parallel mode is as follows:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="kn">import</span> <span class="nn">os</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="kn">from</span> <span class="nn">RiverMapper.river_map_mpi_driver</span> <span class="kn">import</span> <span class="n">river_map_mpi_driver</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="kn">from</span> <span class="nn">RiverMapper.config_river_map</span> <span class="kn">import</span> <span class="n">ConfigRiverMap</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    <span class="n">comm</span><span class="o">=</span><span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="c1"># ------------------------- sample input ---------------------------</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>    <span class="n">dems_json_file</span> <span class="o">=</span> <span class="s1">&#39;/sciclone/schism10/Hgrid_projects/STOFS3D-V6/v16/Inputs/dems.json&#39;</span>  <span class="c1"># specifying files for all DEM tiles</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>    <span class="n">thalweg_shp_fname</span><span class="o">=</span><span class="s1">&#39;/sciclone/schism10/Hgrid_projects/STOFS3D-V6/v16/Shapefiles/CUDEM_Merged_for_v16.shp&#39;</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>    <span class="n">output_dir</span> <span class="o">=</span> <span class="s1">&#39;./Outputs/&#39;</span> <span class="o">+</span>  <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">thalweg_shp_fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">comm</span><span class="o">.</span><span class="n">Get_size</span><span class="p">()</span><span class="si">}</span><span class="s1">-core/&#39;</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>    <span class="n">river_map_config</span> <span class="o">=</span> <span class="n">ConfigRiverMap</span><span class="p">()</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="c1"># ------------------------- end input section ---------------------------</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>    <span class="n">river_map_mpi_driver</span><span class="p">(</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>        <span class="n">dems_json_file</span><span class="o">=</span><span class="n">dems_json_file</span><span class="p">,</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>        <span class="n">thalweg_shp_fname</span><span class="o">=</span><span class="n">thalweg_shp_fname</span><span class="p">,</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>        <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>        <span class="n">river_map_config</span><span class="o">=</span><span class="n">river_map_config</span><span class="p">,</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>        <span class="n">comm</span><span class="o">=</span><span class="n">comm</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>    <span class="p">)</span>
</code></pre></div>
<p>Comparing with the parallel <a href="#parallel-mode">example</a> in the previous section, the above example adds a few lines of code that does the following:</p>
<ul>
<li>importing the "ConfigRiverMap" class</li>
<li>creating a default configuration "river_map_config",</li>
<li>passing the configration to the parallel driver.</li>
</ul>
<p>Since the default configuration is used, this example is essentially the same as the previous parallel example.
But it facilitates further parameter tweaking, e.g.:
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>    <span class="n">river_map_config</span> <span class="o">=</span> <span class="n">ConfigRiverMap</span><span class="o">.</span><span class="n">LooselyFollowRivers</span><span class="p">()</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>    <span class="n">river_map_config</span><span class="o">.</span><span class="n">optional</span><span class="p">[</span><span class="s1">&#39;outer_arc_positions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>    <span class="n">river_map_config</span><span class="o">.</span><span class="n">optional</span><span class="p">[</span><span class="s1">&#39;i_real_clean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div>
, without changing other parts of the code.</p>
<h2 id="more-parameterization">More parameterization<a class="headerlink" href="#more-parameterization" title="Permanent link">&para;</a></h2>
<p>By tweaking the parameters, RiverMapper can also aid in the meshing of a wider range of river sizes or other channel-like features.</p>
<h3 id="hudson-river-and-tributaries">Hudson River and tributaries<a class="headerlink" href="#hudson-river-and-tributaries" title="Permanent link">&para;</a></h3>
<p>This example shows how to customize cross-channel divisions for a main channel that is a few kilometers wide and
smaller tributaries.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kn">import</span> <span class="nn">os</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="kn">from</span> <span class="nn">RiverMapper.river_map_mpi_driver</span> <span class="kn">import</span> <span class="n">river_map_mpi_driver</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="kn">from</span> <span class="nn">RiverMapper.config_river_map</span> <span class="kn">import</span> <span class="n">ConfigRiverMap</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>    <span class="n">comm</span><span class="o">=</span><span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>    <span class="c1"># ------------------------- sample input ---------------------------</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>    <span class="n">dems_json_file</span> <span class="o">=</span> <span class="s1">&#39;/sciclone/schism10/Hgrid_projects/Shared_with_KM/Inputs/dems.json&#39;</span>  <span class="c1"># specifying files for all DEM tiles</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>    <span class="n">thalweg_shp_fname</span><span class="o">=</span><span class="s1">&#39;/sciclone/schism10/Hgrid_projects/Shared_with_KM/Inputs/Thalwegs/thalweg_v16_subset_Hudson2.shp&#39;</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>    <span class="n">output_dir</span> <span class="o">=</span> <span class="s1">&#39;./Outputs/&#39;</span> <span class="o">+</span>  <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">thalweg_shp_fname</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">comm</span><span class="o">.</span><span class="n">Get_size</span><span class="p">()</span><span class="si">}</span><span class="s1">-core/&#39;</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>    <span class="n">river_map_config</span> <span class="o">=</span> <span class="n">ConfigRiverMap</span><span class="p">()</span>  <span class="c1"># initialize a default configuration</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>    <span class="n">river_map_config</span><span class="o">.</span><span class="n">optional</span><span class="p">[</span><span class="s1">&#39;river_threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5000</span><span class="p">)</span>  <span class="c1"># change the search range of river banks to accomodate for Hudson River</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>    <span class="n">river_map_config</span><span class="o">.</span><span class="n">optional</span><span class="p">[</span><span class="s1">&#39;along_channel_reso_thres&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1200</span><span class="p">)</span>  <span class="c1"># change the maximum element length from 300 (default for small rivers) to 1200</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>    <span class="n">river_map_config</span><span class="o">.</span><span class="n">optional</span><span class="p">[</span><span class="s1">&#39;length_width_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">4.0</span>  <span class="c1"># set element aspect ratio as needed</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>    <span class="c1"># Customize a width-to-narcs function and pass it to the configuration.</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>    <span class="k">def</span> <span class="nf">width2narcs</span><span class="p">(</span><span class="n">width</span><span class="p">):</span>  <span class="c1"># do not change this line even if width is not used</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>        <span class="n">narcs</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># you can specify more sophisticated configurations here as needed</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>        <span class="k">return</span> <span class="n">narcs</span>  <span class="c1"># narcs is the number of rows in the cross-channel direction.</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>    <span class="c1"># pass the customized function to the configuration</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>    <span class="n">river_map_config</span><span class="o">.</span><span class="n">optional</span><span class="p">[</span><span class="s1">&#39;custom_width2narcs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">width2narcs</span>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>    <span class="c1"># ------------------------- end input section ---------------------------</span>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>    <span class="n">river_map_mpi_driver</span><span class="p">(</span>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>        <span class="n">dems_json_file</span><span class="o">=</span><span class="n">dems_json_file</span><span class="p">,</span>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a>        <span class="n">thalweg_shp_fname</span><span class="o">=</span><span class="n">thalweg_shp_fname</span><span class="p">,</span>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>        <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">,</span>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a>        <span class="n">river_map_config</span><span class="o">=</span><span class="n">river_map_config</span><span class="p">,</span>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a>        <span class="n">comm</span><span class="o">=</span><span class="n">comm</span>
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>    <span class="p">)</span>
</code></pre></div>
<p>The above code adds more customization to the parallel example.
Please read the comments which explain each piece of customization.
In particular, note how to pass a customized width-to-narcs function to the configuration.
This function takes the width of a river and returns the number of rows in the cross-channel directions.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The option 'river_threshold' specifies the min and max river width to be resolved, which affects the search range of river banks.
A large value like 5000 m used here can slow down the execution compared to the default value (600 m, for small watershed rivers).
In the future, we will allow users to select rivers and specify different values for this option.</p>
</div>
<p>Here, a simplest function is used that specifies five rows of arcs regardless of river width,
and the result is shown below:</p>
<p><img alt="Hudson river" src="../../assets/Hudson.jpg" /></p>
<p>Of course you can specify  more sophisticated functions depending on your needs, e.g.,</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">nrow</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">min_arcs</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">width</span> <span class="o">/</span> <span class="mi">100</span><span class="p">))</span>  <span class="c1"># add one arc for every increase of 100 m</span>
</code></pre></div>
<p>or</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">nrow</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">min_arcs</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">0.35</span><span class="o">*</span><span class="n">width</span><span class="o">**</span><span class="mf">0.25</span><span class="p">))</span>  <span class="c1"># add one arc for every increase of one order of magnitude</span>
</code></pre></div>
<p>or even make a master plan (similar to the master grid for SCHISM's <a href="https://feiye-vims.github.io/schism-tut/docs/compound-flood/vgrid_3d">vgrid</a>) of how many arcs should be used for a given river width.</p>
<h3 id="levees">Levees<a class="headerlink" href="#levees" title="Permanent link">&para;</a></h3>
<p>In the STOFS-3D-Atlantic domain, levees are important features to be incorporated in the model mesh.
Instead of parameterizing them as hydraulic structures, the levees are explicitly represented by meter-scale elements,
with two rows of nodes resolving the feet of the levee and another two rows resolving the top of the levee:</p>
<p><img alt="Sample river map" src="../../assets/sample-levee-map.png" /> </p>
<p>With the levee centerlines available from National Levee Database,
the levee map can be easily made by invoking the pseudo channel option of RiverMapper:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">river_map_config</span> <span class="o">=</span> <span class="n">ConfigRiverMap</span><span class="o">.</span><span class="n">Levees</span><span class="p">()</span>
</code></pre></div>
<p>Notice that the along-channel (in this case along-levee) resolution also adapts for bends,
just like for rivers.</p>
<h3 id="barrier-islands">Barrier islands<a class="headerlink" href="#barrier-islands" title="Permanent link">&para;</a></h3>
<p>Barrier islands are long and narrow topographical features similar to river channels.
In fact, the map of a barrier island can be made in the same way as river channels
if the sign of the DEM's elevation values is inverted.</p>
<p><img alt="Sample river map" src="../../assets/sample-barrier-island-map.png" /> </p>
<p>This can be done by setting the optional parameter "elev_scale" to "-1",
or directly invoking the preset "BarrierIsland":</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">river_map_config</span> <span class="o">=</span> <span class="n">ConfigRiverMap</span><span class="o">.</span><span class="n">BarrierIsland</span><span class="p">()</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The above two sample applications can also be found in 
<a href="http://ccrm.vims.edu/yinglong/feiye/Public/RiverMapper_Samples.tar">RiverMapper_Samples.tar</a></p>
</div>
<h2 id="experimental-features">Experimental Features<a class="headerlink" href="#experimental-features" title="Permanent link">&para;</a></h2>
<h3 id="global-arc-cleaning">Global arc cleaning<a class="headerlink" href="#global-arc-cleaning" title="Permanent link">&para;</a></h3>
<p>The experimental option "i_real_clean" has been removed from the parameter list,
because it has superseded all other options for river confluence cleaning.
It is the only cleaning option in the latest code and enabled by default.</p>
<p>The idea is simple: arc vertices that are too close to any vertex or arc segment are snapped to the closest vertices.</p>
<p>A critical step is defining how close is close.
Setting a global threshold value would not work well because a larger value tends to over-simplify small rivers thus not ensuring channel connectivity
and a smaller value causes insufficient cleaning for larger rivers.
As a result, a spatially varying threshold is specified for each vertex based on the cross-channel resolution at that location.
This ensures a sufficent level of cleaning while maintaining channel connectivity.
For example, the resolution around a confluence is largely determined by the smallest branch:
<img alt="Confluence_cleaning" src="../../assets/confluence_cleaning.png" /> </p>
<p>For a continental application like STOFS-3D-Atlantic that includes about 30,000 rivers, the cleaning takes about 10 minutes.
Since the algorithm is fairly efficient, several iterations of cleaning are implemented allowing the threshold gradually increasing from a small value to the target value;
in other words, the most close-by vertices are snapped first, which prevents overly aggressive snapping and slightly improve the quality of the end product.</p>
<h3 id="outputs-for-ocsmesh">Outputs for OCSMesh<a class="headerlink" href="#outputs-for-ocsmesh" title="Permanent link">&para;</a></h3>
<p>The "i_OCSMesh" option leads to an extra shapefile output containing river polygons,
which serves as an input to <a href="https://github.com/noaa-ocs-modeling/OCSMesh">OCSMesh</a>.
The option is enabled by default because the polygon-based output may be useful for other mesh generators too.</p>
<h3 id="outputting-river-mesh-elements">Outputting river mesh elements<a class="headerlink" href="#outputting-river-mesh-elements" title="Permanent link">&para;</a></h3>
<p>It may be desirable in some circumstances to directly discretize river polygons into elements (quadrangles and triangles).
However, this is not the intended function of the tool at least by its original design but rather a task for mesh generators.<br />
In addition, the accuracy and efficiency of SCHISM are not sensitive to how mesh generators decide to form the elements (as quads or triangles), as long as they adhere to the given river arcs or polygons.
We can implement this option if there is a need.</p>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="extract-thalweg.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Extract thalwegs" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Extract thalwegs
            </div>
          </div>
        </a>
      
      
        
        <a href="meshing-in-SMS.html" class="md-footer__link md-footer__link--next" aria-label="Next: Meshing in SMS" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Meshing in SMS
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["toc.integrate", "toc.follow", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.85cb4492.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f758a944.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>